{"version":3,"file":"history-plugin.debug.js","sources":["../src/history.js","../src/action.js","../src/actions/node.js","../src/actions/connection.js","../src/index.js"],"sourcesContent":["export default class History {\n    constructor() {\n        this.active = false;\n        this.produced = [];\n        this.reserved = [];\n    }\n\n    add(action) {\n        if(this.active) return;\n        this.produced.push(action);\n        this.reserved = [];\n    }\n\n    _do(from, to, type) {\n        const action = from.pop();\n        if(!action) return;\n\n        this.active = true;\n        action[type]();\n        to.push(action);\n        this.active = false;\n    }\n\n    undo() {\n        this._do(this.produced, this.reserved, 'undo');\n    }\n\n    redo() {\n        this._do(this.reserved, this.produced, 'redo');\n    }\n}","export default class Action {\n    undo() {}\n    redo() {}\n}","import Action from '../action';\n\nexport class AddNodeAction extends Action {\n    constructor(editor, node) {\n        super();\n        this.editor = editor;\n        this.node = node;\n    }\n    undo() {\n        this.editor.removeNode(this.node);\n    }\n    redo() {\n        this.editor.addNode(this.node);\n    }\n}\n\nexport class RemoveNodeAction extends Action {\n    constructor(editor, node) {\n        super();\n        this.editor = editor;\n        this.node = node;\n    }\n    undo() {\n        this.editor.addNode(this.node);\n    }\n    redo() {\n        this.editor.removeNode(this.node);\n    }\n}","import Action from '../action';\n\nfunction reassign(connection) {\n    const { input, output } = connection;\n\n    return output.connections.find(c => c.input === input);\n}\n\nexport class AddConnectionAction extends Action {\n    constructor(editor, connection) {\n        super();\n        this.editor = editor;\n        this.connection = connection;\n    }\n    undo() {\n        this.editor.removeConnection(this.connection);\n    }\n    redo() {\n        this.editor.connect(this.connection.output, this.connection.input);\n        this.connection = reassign(this.connection);\n    }\n}\n\nexport class RemoveConnectionAction extends Action {\n    constructor(editor, connection) {\n        super();\n        this.editor = editor;\n        this.connection = connection;\n    }\n    undo() {\n        this.editor.connect(output, input);\n        this.connection = reassign(this.connection);\n    }\n    redo() {\n        this.editor.removeConnection(this.connection);\n    }\n}\n","import History from './history';\nimport Action from './action';\nimport { AddNodeAction, RemoveNodeAction } from './actions/node';\nimport { AddConnectionAction, RemoveConnectionAction } from './actions/connection';\n\nfunction install(editor, { keyboard = true }) {\n    editor.bind('undo');\n    editor.bind('redo');\n    editor.bind('addhistory');\n\n    const history = new History();\n\n    editor.on('undo', () => history.undo());\n    editor.on('redo', () => history.redo());\n    editor.on('addhistory', action => history.add(action));\n\n    editor.on('nodecreated', node => history.add(new AddNodeAction(editor, node)));\n    editor.on('noderemoved', node => history.add(new RemoveNodeAction(editor, node)));\n    editor.on('connectioncreated', c => history.add(new AddConnectionAction(editor, c)));\n    editor.on('connectionremoved', c => history.add(new RemoveConnectionAction(editor, c)));\n\n    \n    if(keyboard) document.addEventListener('keydown', e => {\n        if(!e.ctrlKey) return;\n\n        switch(e.code) {\n            case 'KeyZ': editor.trigger('undo'); break;\n            case 'KeyY': editor.trigger('redo'); break;\n        }\n    });\n}\n\nexport default {\n    name: 'history',\n    install,\n    Action\n}"],"names":["History","constructor","active","produced","reserved","add","action","push","_do","from","to","type","pop","undo","redo","Action","AddNodeAction","editor","node","removeNode","addNode","RemoveNodeAction","reassign","connection","input","output","connections","find","c","AddConnectionAction","removeConnection","connect","RemoveConnectionAction","install","keyboard","bind","history","on","document","addEventListener","e","ctrlKey","code","trigger","name"],"mappings":"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"}